# 広告プレビューシステム要件書

## 概要

広告検出時のユーザー選択ダイアログで、検出された広告要素の画像プレビューを表示し、ユーザーがより適切な判断を行えるようにするシステムを実装する。

## 要件

### 要件1: 広告要素のスクリーンショット機能

**ユーザーストーリー:** 開発者として、検出された広告要素のスクリーンショットを取得できるようにしたい。これにより、ユーザーが何をブロックしようとしているかを視覚的に確認できる。

#### 受入基準
1. WHEN 広告要素が検出された THEN システムは該当要素のスクリーンショットを取得する SHALL
2. WHEN 複数の広告要素が検出された THEN システムは各要素のスクリーンショットを個別に取得する SHALL
3. IF 要素が画面外にある THEN システムは要素を一時的にスクロール表示してスクリーンショットを取得する SHALL
4. WHEN スクリーンショット取得に失敗した THEN システムは代替表示（要素情報テキスト）を提供する SHALL

### 要件2: プレビュー画像の表示機能

**ユーザーストーリー:** ユーザーとして、ブロックしようとしている広告がどのようなものかを画像で確認したい。これにより、誤ってコンテンツをブロックすることを防げる。

#### 受入基準
1. WHEN ユーザー選択ダイアログが表示される THEN 検出された広告のプレビュー画像が表示される SHALL
2. WHEN 複数の広告が検出された THEN 各広告のプレビューがサムネイル形式で表示される SHALL
3. IF プレビュー画像が利用できない THEN 要素の詳細情報（タグ名、クラス、サイズ等）がテキストで表示される SHALL

### 要件3: パフォーマンス最適化

**ユーザーストーリー:** ユーザーとして、プレビュー機能によってページの動作が重くなることを避けたい。

#### 受入基準
1. WHEN スクリーンショットを取得する THEN 処理時間は500ms以内に完了する SHALL
2. WHEN 画像サイズが大きい THEN 自動的にリサイズして表示する SHALL
3. WHEN メモリ使用量が多い THEN 古いプレビュー画像を自動削除する SHALL
4. IF スクリーンショット処理が重い THEN ユーザーに処理中であることを示すローディング表示を行う SHALL

### 要件4: プライバシー保護

**ユーザーストーリー:** ユーザーとして、プレビュー機能によって個人情報が漏洩することを避けたい。

#### 受入基準
1. WHEN プレビュー画像を生成する THEN 画像は一時的にのみメモリに保存される SHALL
2. WHEN ダイアログが閉じられる THEN プレビュー画像は即座に削除される SHALL
3. WHEN 個人情報を含む可能性がある要素を検出した THEN プレビューにぼかし処理を適用する SHALL
4. IF 機密性の高いページ（銀行サイト等）を検出した THEN プレビュー機能を無効化する SHALL

### 要件5: ユーザビリティ向上

**ユーザーストーリー:** ユーザーとして、プレビュー機能によってより使いやすいインターフェースを利用したい。

#### 受入基準
1. WHEN プレビュー画像が表示される THEN 画像の下に要素の基本情報（サイズ、位置、タイプ）が表示される SHALL
2. WHEN 複数のプレビューがある THEN ユーザーは個別に選択してブロック/許可を決められる SHALL
3. WHEN プレビューを確認した THEN 「すべてブロック」「すべて許可」の一括操作も可能である SHALL
4. IF プレビューの読み込みに時間がかかる THEN ユーザーはプレビューなしで選択を続行できる SHALL