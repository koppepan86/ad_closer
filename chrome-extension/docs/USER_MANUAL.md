# 広告プレビューシステム ユーザーマニュアル

## 目次
1. [概要](#概要)
2. [インストール](#インストール)
3. [基本的な使い方](#基本的な使い方)
4. [プレビュー機能](#プレビュー機能)
5. [個別選択機能](#個別選択機能)
6. [一括操作機能](#一括操作機能)
7. [設定とカスタマイズ](#設定とカスタマイズ)
8. [プライバシーとセキュリティ](#プライバシーとセキュリティ)
9. [トラブルシューティング](#トラブルシューティング)
10. [よくある質問](#よくある質問)

## 概要

広告プレビューシステムは、ウェブサイト上で検出された広告要素の画像プレビューを表示し、ユーザーがより適切な判断を行えるようにするChrome拡張機能です。

### 主な機能
- **広告要素の自動検出**: ポップアップ、オーバーレイ、バナー広告などを自動的に検出
- **プレビュー画像表示**: 検出された広告の画像プレビューを生成・表示
- **個別選択機能**: 各広告に対して個別にブロック/許可を選択
- **一括操作機能**: 複数の広告を一度にブロック/許可
- **プライバシー保護**: 画像は一時的にのみ保存され、自動的に削除

## インストール

### Chrome ウェブストアからのインストール
1. Chrome ウェブストアで「広告プレビューシステム」を検索
2. 「Chromeに追加」ボタンをクリック
3. 確認ダイアログで「拡張機能を追加」をクリック

### 手動インストール（開発者向け）
1. 拡張機能のソースコードをダウンロード
2. Chrome で `chrome://extensions/` を開く
3. 「デベロッパーモード」を有効にする
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. ソースコードのフォルダを選択

### 必要な権限
- **activeTab**: 現在のタブでの広告検出
- **storage**: 設定とプレビューデータの一時保存
- **notifications**: 検出結果の通知表示

## 基本的な使い方

### 1. 拡張機能の有効化
インストール後、拡張機能は自動的に有効になります。ツールバーのアイコンで状態を確認できます。

### 2. 広告検出の開始
ウェブページを開くと、拡張機能が自動的に広告要素を検出します。検出された場合、選択ダイアログが表示されます。

### 3. 基本的な操作フロー
```
ウェブページ閲覧
    ↓
広告検出（自動）
    ↓
プレビュー生成
    ↓
選択ダイアログ表示
    ↓
ユーザー選択
    ↓
アクション実行
```

## プレビュー機能

### プレビュー画像の表示
検出された広告要素は、以下の形式でプレビュー表示されます：

#### サムネイル表示
- **サイズ**: 300×200ピクセル
- **形式**: WebP（対応していない場合はPNG）
- **品質**: 80%圧縮
- **表示位置**: 選択ダイアログ内のギャラリー

#### 拡大表示
- **サイズ**: 800×600ピクセル
- **操作**: サムネイルをクリックで拡大表示
- **機能**: 詳細情報の表示、個別選択ボタン

### プレビューが表示されない場合
以下の場合、代替表示が行われます：
- スクリーンショット取得に失敗した場合
- 要素が画面外にある場合
- プライバシー保護により無効化された場合

代替表示には以下の情報が含まれます：
- 要素のタイプ（オーバーレイ、バナーなど）
- サイズ情報（幅×高さ）
- 位置情報
- クラス名やID

## 個別選択機能

### 個別選択の方法
1. **サムネイル下のボタン**: 各プレビューの下にある「許可」「ブロック」ボタン
2. **拡大表示での選択**: 拡大表示モーダル内のアクションボタン
3. **キーボード操作**: Tab キーでナビゲーション、Enter で選択

### 選択状態の表示
- **許可**: 緑色のボーダーと背景
- **ブロック**: 赤色のボーダーと背景
- **未選択**: グレーのボーダー

### 選択状態の変更
選択は何度でも変更可能です。最後に選択した状態が適用されます。

## 一括操作機能

### 一括操作の種類
- **すべて許可**: 検出されたすべての広告を許可
- **すべてブロック**: 検出されたすべての広告をブロック

### 一括操作の実行
1. ダイアログ下部の一括操作ボタンをクリック
2. 確認ダイアログで操作内容を確認
3. 「実行」ボタンで操作を確定

### 確認ダイアログの内容
- 対象となる広告の数
- 実行される操作の詳細
- 取り消し不可の警告
- 実行/キャンセルボタン

## 設定とカスタマイズ

### 基本設定
拡張機能のアイコンを右クリック → 「オプション」で設定画面を開きます。

#### 一般設定
- **拡張機能の有効/無効**: 全体的な機能のオン/オフ
- **通知の表示**: 検出時の通知表示の有無
- **自動タイマー**: 自動許可までの時間（5-30秒）

#### プレビュー設定
- **プレビュー品質**: 画像の品質設定（低/中/高）
- **プレビューサイズ**: サムネイルサイズの調整
- **遅延読み込み**: 画面外要素の遅延読み込み

#### プライバシー設定
- **プライバシーレベル**: 低/中/高
- **機密サイト検出**: 銀行サイトなどでの無効化
- **個人情報検出**: 個人情報を含む要素のぼかし処理

### サイト別設定
特定のサイトに対する個別設定が可能です：
- **ホワイトリスト**: 常に許可するサイト
- **ブラックリスト**: 常にブロックするサイト
- **プレビュー無効サイト**: プレビューを表示しないサイト

### キーボードショートカット
- **Ctrl+Shift+A**: 拡張機能の有効/無効切り替え
- **Ctrl+Shift+P**: 設定画面を開く
- **Esc**: ダイアログを閉じる（許可として処理）

## プライバシーとセキュリティ

### データの取り扱い
- **画像データ**: メモリ内にのみ一時保存、ダイアログ閉じ時に自動削除
- **設定データ**: ローカルストレージに保存、外部送信なし
- **統計データ**: 匿名化されたローカル統計のみ

### プライバシー保護機能
- **一時的保存**: プレビュー画像は永続的に保存されません
- **自動削除**: ダイアログ閉じ時に即座に削除
- **機密サイト検出**: 銀行サイトなどでプレビュー機能を自動無効化
- **個人情報保護**: 個人情報を含む可能性がある要素にぼかし処理

### セキュリティ対策
- **Content Security Policy**: 厳格なCSP設定
- **権限の最小化**: 必要最小限の権限のみ使用
- **入力検証**: すべての入力データの検証
- **依存関係管理**: 定期的な脆弱性スキャン

## トラブルシューティング

### よくある問題と解決方法

#### プレビューが表示されない
**症状**: 広告は検出されるがプレビュー画像が表示されない

**原因と解決方法**:
1. **html2canvas ライブラリの問題**
   - ページを再読み込みしてください
   - 他のタブを閉じてメモリを解放してください

2. **要素が画面外にある**
   - 自動スクロール機能が有効になっているか確認
   - 手動で要素を画面内に表示してください

3. **プライバシー保護による無効化**
   - 設定でプライバシーレベルを下げてください
   - サイトをホワイトリストに追加してください

#### ダイアログが表示されない
**症状**: 広告が検出されてもダイアログが表示されない

**解決方法**:
1. 拡張機能が有効になっているか確認
2. ページを再読み込み
3. 他の拡張機能との競合を確認
4. Chrome を再起動

#### 動作が重い
**症状**: プレビュー生成時にページが重くなる

**解決方法**:
1. プレビュー品質を「低」に設定
2. 遅延読み込みを有効にする
3. 並列処理数を減らす
4. 不要なタブを閉じる

#### 選択が反映されない
**症状**: 選択したアクションが実行されない

**解決方法**:
1. ダイアログを閉じずに選択を確定
2. 一括操作の場合は確認ダイアログで実行
3. ページを再読み込みして再試行

### エラーメッセージと対処法

#### "プレビュー生成に失敗しました"
- **原因**: スクリーンショット取得エラー
- **対処**: ページ再読み込み、設定で品質を下げる

#### "メモリ不足です"
- **原因**: 大量のプレビュー生成によるメモリ不足
- **対処**: タブを閉じる、Chrome再起動

#### "権限が不足しています"
- **原因**: 必要な権限が無効になっている
- **対処**: 拡張機能の権限設定を確認

### ログの確認方法
1. Chrome で F12 を押して開発者ツールを開く
2. Console タブを選択
3. "AdPreview" でフィルタリング
4. エラーメッセージを確認

## よくある質問

### Q: プレビュー画像はどこに保存されますか？
A: プレビュー画像はメモリ内にのみ一時的に保存され、ダイアログを閉じると自動的に削除されます。ハードディスクには保存されません。

### Q: すべてのサイトで動作しますか？
A: ほとんどのサイトで動作しますが、以下の場合は制限があります：
- 機密サイト（銀行サイトなど）では自動的に無効化
- iframe内の要素は検出できない場合があります
- 一部のSPAサイトでは検出精度が低下する可能性があります

### Q: 他の広告ブロッカーと併用できますか？
A: 基本的に併用可能ですが、以下の点にご注意ください：
- 他の拡張機能が先に広告をブロックした場合、検出できません
- 競合により動作が不安定になる場合があります
- パフォーマンスに影響する可能性があります

### Q: モバイル版Chromeで使用できますか？
A: 申し訳ございませんが、現在はデスクトップ版Chromeのみ対応しています。

### Q: プレビュー生成が遅い場合の対処法は？
A: 以下の設定を試してください：
1. プレビュー品質を「低」に設定
2. 遅延読み込みを有効にする
3. 並列処理数を1に設定
4. 不要なタブを閉じてメモリを解放

### Q: 特定のサイトでのみ無効にできますか？
A: はい、設定画面でサイト別の設定が可能です：
1. 拡張機能アイコンを右クリック
2. 「オプション」を選択
3. 「サイト別設定」タブを開く
4. 無効にしたいサイトを追加

### Q: プライバシーは保護されますか？
A: はい、以下の対策を実施しています：
- 画像の一時的保存のみ
- 外部サーバーへのデータ送信なし
- 機密サイトでの自動無効化
- 個人情報検出とぼかし処理

### Q: アップデートはどのように行われますか？
A: Chrome ウェブストア経由でインストールした場合、自動的にアップデートされます。手動インストールの場合は、新しいバージョンを手動でインストールしてください。

### Q: 問題が解決しない場合は？
A: 以下の手順をお試しください：
1. Chrome を再起動
2. 拡張機能を無効化→有効化
3. 設定をデフォルトにリセット
4. 他の拡張機能を一時的に無効化

それでも解決しない場合は、開発者ツールのコンソールログと共にサポートまでご連絡ください。

---

## サポート情報

- **バージョン**: 1.0.0
- **対応ブラウザ**: Chrome 88以上
- **最終更新**: 2024年8月
- **ライセンス**: MIT License

このマニュアルは定期的に更新されます。最新版は拡張機能の設定画面からアクセスできます。