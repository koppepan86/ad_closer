<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æ”¹å–„æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }

        .test-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }

        .test-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .test-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .test-button:hover {
            background: #0056b3;
        }

        .test-button:focus {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }

        .test-button.secondary {
            background: #6c757d;
        }

        .test-button.secondary:hover {
            background: #545b62;
        }

        .test-button.danger {
            background: #dc3545;
        }

        .test-button.danger:hover {
            background: #c82333;
        }

        .test-results {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            min-height: 100px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 300px;
        }

        .mock-ads {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }

        .mock-ad {
            border: 2px dashed #ff6b6b;
            padding: 20px;
            border-radius: 8px;
            background: #fff5f5;
            text-align: center;
            min-width: 200px;
            position: relative;
        }

        .mock-ad::before {
            content: 'ğŸ“¢';
            font-size: 24px;
            display: block;
            margin-bottom: 10px;
        }

        .accessibility-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }

        .accessibility-info h4 {
            margin-top: 0;
            color: #0066cc;
        }

        .keyboard-shortcuts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .shortcut-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }

        .shortcut-key {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            padding: 2px 6px;
            font-family: monospace;
            font-weight: bold;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .metric-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.success {
            background: #28a745;
        }

        .status-indicator.warning {
            background: #ffc107;
        }

        .status-indicator.error {
            background: #dc3545;
        }

        .browser-compatibility {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .browser-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
        }

        .browser-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        /* é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
        @media (prefers-contrast: high) {
            .test-button {
                border: 2px solid;
            }
            
            .mock-ad {
                border-width: 3px;
            }
        }

        /* å‹•ãã‚’æ¸›ã‚‰ã™è¨­å®šã¸ã®å¯¾å¿œ */
        @media (prefers-reduced-motion: reduce) {
            .test-button {
                transition: none;
            }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .test-controls {
                flex-direction: column;
            }
            
            .test-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æ”¹å–„æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
            <p>Task 12: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ç¶šè¡Œæ©Ÿèƒ½ã€ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œã€åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã®æ¤œè¨¼</p>
        </div>

        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ç¶šè¡Œæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3>1. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ç¶šè¡Œæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
            <div class="accessibility-info">
                <h4>ãƒ†ã‚¹ãƒˆå†…å®¹</h4>
                <ul>
                    <li>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆå¤±æ•—æ™‚ã®ç¶šè¡Œãƒœã‚¿ãƒ³è¡¨ç¤º</li>
                    <li>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã®é¸æŠè‚¢è¡¨ç¤º</li>
                    <li>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ã§ã®å€‹åˆ¥é¸æŠæ©Ÿèƒ½</li>
                    <li>åŸºæœ¬çš„ãªåºƒå‘Šæƒ…å ±è¡¨ç¤º</li>
                </ul>
            </div>
            
            <div class="mock-ads">
                <div class="mock-ad" data-ad-type="banner">
                    ãƒãƒŠãƒ¼åºƒå‘Š<br>
                    <small>728x90px</small>
                </div>
                <div class="mock-ad" data-ad-type="overlay">
                    ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤åºƒå‘Š<br>
                    <small>300x250px</small>
                </div>
                <div class="mock-ad" data-ad-type="popup">
                    ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—åºƒå‘Š<br>
                    <small>400x300px</small>
                </div>
            </div>

            <div class="test-controls">
                <button class="test-button" onclick="testPreviewFailure()">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆå¤±æ•—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
                <button class="test-button" onclick="testPreviewTimeout()">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
                <button class="test-button" onclick="testContinueWithoutPreview()">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ç¶šè¡Œã‚’ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-button secondary" onclick="clearResults('preview-results')">çµæœã‚¯ãƒªã‚¢</button>
            </div>

            <div class="test-results" id="preview-results">ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
        </div>

        <!-- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3>2. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
            <div class="accessibility-info">
                <h4>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</h4>
                <div class="keyboard-shortcuts">
                    <div class="shortcut-item">
                        <div><span class="shortcut-key">Tab</span></div>
                        <div>ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•</div>
                    </div>
                    <div class="shortcut-item">
                        <div><span class="shortcut-key">Enter</span> / <span class="shortcut-key">Space</span></div>
                        <div>ãƒœã‚¿ãƒ³å®Ÿè¡Œ</div>
                    </div>
                    <div class="shortcut-item">
                        <div><span class="shortcut-key">Escape</span></div>
                        <div>ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–‰ã˜ã‚‹</div>
                    </div>
                    <div class="shortcut-item">
                        <div><span class="shortcut-key">Ctrl+A</span></div>
                        <div>ã™ã¹ã¦è¨±å¯</div>
                    </div>
                    <div class="shortcut-item">
                        <div><span class="shortcut-key">Ctrl+B</span></div>
                        <div>ã™ã¹ã¦ãƒ–ãƒ­ãƒƒã‚¯</div>
                    </div>
                    <div class="shortcut-item">
                        <div><span class="shortcut-key">1-9</span></div>
                        <div>å€‹åˆ¥è¨±å¯</div>
                    </div>
                    <div class="shortcut-item">
                        <div><span class="shortcut-key">Shift+1-9</span></div>
                        <div>å€‹åˆ¥ãƒ–ãƒ­ãƒƒã‚¯</div>
                    </div>
                </div>
            </div>

            <div class="test-controls">
                <button class="test-button" onclick="testKeyboardNavigation()">ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³</button>
                <button class="test-button" onclick="testScreenReader()">ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ</button>
                <button class="test-button" onclick="testFocusTrap()">ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—</button>
                <button class="test-button" onclick="testAriaLabels()">ARIAãƒ©ãƒ™ãƒ«</button>
                <button class="test-button" onclick="testHighContrast()">é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</button>
                <button class="test-button secondary" onclick="clearResults('accessibility-results')">çµæœã‚¯ãƒªã‚¢</button>
            </div>

            <div class="test-results" id="accessibility-results">ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3>3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
            <div class="performance-metrics">
                <div class="metric-item">
                    <div class="metric-value" id="dialog-creation-time">-</div>
                    <div class="metric-label">ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä½œæˆæ™‚é–“ (ms)</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="visual-feedback-time">-</div>
                    <div class="metric-label">è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ (ms)</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="keyboard-response-time">-</div>
                    <div class="metric-label">ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¿œç­” (ms)</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="memory-usage">-</div>
                    <div class="metric-label">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ (MB)</div>
                </div>
            </div>

            <div class="test-controls">
                <button class="test-button" onclick="testDialogCreationPerformance()">ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä½œæˆæ€§èƒ½</button>
                <button class="test-button" onclick="testVisualFeedbackPerformance()">è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ€§èƒ½</button>
                <button class="test-button" onclick="testKeyboardPerformance()">ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¿œç­”æ€§èƒ½</button>
                <button class="test-button" onclick="testMemoryUsage()">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</button>
                <button class="test-button" onclick="testBulkOperations()">ä¸€æ‹¬æ“ä½œæ€§èƒ½</button>
                <button class="test-button secondary" onclick="clearResults('performance-results')">çµæœã‚¯ãƒªã‚¢</button>
            </div>

            <div class="test-results" id="performance-results">ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
        </div>

        <!-- ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3>4. ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒ†ã‚¹ãƒˆ</h3>
            <div class="browser-compatibility">
                <div class="browser-item">
                    <div class="browser-icon">ğŸŒ</div>
                    <div>Chrome</div>
                    <div><span class="status-indicator success" id="chrome-status"></span><span id="chrome-version">-</span></div>
                </div>
                <div class="browser-item">
                    <div class="browser-icon">ğŸ¦Š</div>
                    <div>Firefox</div>
                    <div><span class="status-indicator success" id="firefox-status"></span><span id="firefox-version">-</span></div>
                </div>
                <div class="browser-item">
                    <div class="browser-icon">ğŸ§­</div>
                    <div>Safari</div>
                    <div><span class="status-indicator warning" id="safari-status"></span><span id="safari-version">-</span></div>
                </div>
                <div class="browser-item">
                    <div class="browser-icon">ğŸŒŠ</div>
                    <div>Edge</div>
                    <div><span class="status-indicator success" id="edge-status"></span><span id="edge-version">-</span></div>
                </div>
            </div>

            <div class="test-controls">
                <button class="test-button" onclick="testBrowserFeatures()">ãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½æ¤œå‡º</button>
                <button class="test-button" onclick="testCSSSupport()">CSSæ©Ÿèƒ½ã‚µãƒãƒ¼ãƒˆ</button>
                <button class="test-button" onclick="testEventHandling()">ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†äº’æ›æ€§</button>
                <button class="test-button" onclick="testDOMManipulation()">DOMæ“ä½œäº’æ›æ€§</button>
                <button class="test-button secondary" onclick="clearResults('compatibility-results')">çµæœã‚¯ãƒªã‚¢</button>
            </div>

            <div class="test-results" id="compatibility-results">ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
        </div>

        <!-- çµ±åˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3>5. çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
            <div class="accessibility-info">
                <h4>ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª</h4>
                <ol>
                    <li>è¤‡æ•°åºƒå‘Šæ¤œå‡º â†’ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º</li>
                    <li>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆå¤±æ•— â†’ ç¶šè¡Œãƒœã‚¿ãƒ³è¡¨ç¤º</li>
                    <li>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–</li>
                    <li>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§å€‹åˆ¥é¸æŠ</li>
                    <li>è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç¢ºèª</li>
                    <li>ä¸€æ‹¬æ“ä½œå®Ÿè¡Œ</li>
                    <li>çµæœç¢ºèªã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—</li>
                </ol>
            </div>

            <div class="test-controls">
                <button class="test-button" onclick="runFullIntegrationTest()">å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button class="test-button" onclick="runAccessibilityIntegrationTest()">ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£çµ±åˆãƒ†ã‚¹ãƒˆ</button>
                <button class="test-button" onclick="runPerformanceIntegrationTest()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ</button>
                <button class="test-button danger" onclick="runStressTest()">ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-button secondary" onclick="clearResults('integration-results')">çµæœã‚¯ãƒªã‚¢</button>
            </div>

            <div class="test-results" id="integration-results">ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
        </div>
    </div>

    <!-- ãƒ©ã‚¤ãƒ–ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ç”¨ï¼‰ -->
    <div id="live-region" aria-live="polite" aria-atomic="true" style="position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;"></div>

    <script>
        // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯ã‚¯ãƒ©ã‚¹
        class MockUserChoiceDialog {
            constructor() {
                this.activeDialogs = new Map();
                this.dialogCounter = 0;
                this.performanceMetrics = new Map();
            }

            async showChoiceDialog(detectedAds) {
                const startTime = performance.now();
                const dialogId = `dialog-${++this.dialogCounter}`;
                
                // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä½œæˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                await new Promise(resolve => setTimeout(resolve, Math.random() * 50 + 10));
                
                const endTime = performance.now();
                const creationTime = endTime - startTime;
                
                this.performanceMetrics.set(`creation-${dialogId}`, creationTime);
                this.activeDialogs.set(dialogId, {
                    detectedAds,
                    individualSelections: new Map(),
                    createdAt: startTime
                });

                return { dialogId, creationTime };
            }

            enableContinueWithoutPreview(dialogId) {
                const dialogData = this.activeDialogs.get(dialogId);
                if (dialogData) {
                    dialogData.continueWithoutPreview = true;
                    return true;
                }
                return false;
            }

            updateVisualFeedback(dialogId) {
                const startTime = performance.now();
                
                // è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ›´æ–°ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                const dialogData = this.activeDialogs.get(dialogId);
                if (dialogData) {
                    dialogData.lastUpdate = startTime;
                }
                
                const endTime = performance.now();
                const updateTime = endTime - startTime;
                this.performanceMetrics.set(`feedback-${dialogId}`, updateTime);
                
                return updateTime;
            }

            handleKeyboardShortcut(dialogId, key) {
                const startTime = performance.now();
                
                const dialogData = this.activeDialogs.get(dialogId);
                if (dialogData) {
                    dialogData.lastKeyboard = { key, timestamp: startTime };
                }
                
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                this.performanceMetrics.set(`keyboard-${dialogId}`, responseTime);
                
                return responseTime;
            }

            getPerformanceMetric(key) {
                return this.performanceMetrics.get(key);
            }

            cleanup() {
                this.activeDialogs.clear();
                this.performanceMetrics.clear();
            }
        }

        class MockAccessibilityHelper {
            constructor() {
                this.features = new Map();
                this.detectBrowserFeatures();
            }

            detectBrowserFeatures() {
                this.features.set('matchMedia', typeof window.matchMedia === 'function');
                this.features.set('requestAnimationFrame', typeof window.requestAnimationFrame === 'function');
                this.features.set('addEventListener', typeof document.addEventListener === 'function');
                this.features.set('querySelector', typeof document.querySelector === 'function');
                this.features.set('classList', 'classList' in document.createElement('div'));
                this.features.set('ariaSupport', 'setAttribute' in document.createElement('div'));
            }

            getBrowserFeatures() {
                return Object.fromEntries(this.features);
            }

            announceToScreenReader(message) {
                const liveRegion = document.getElementById('live-region');
                if (liveRegion) {
                    liveRegion.textContent = message;
                    setTimeout(() => {
                        liveRegion.textContent = '';
                    }, 1000);
                }
            }

            testKeyboardNavigation() {
                // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ
                const focusableElements = document.querySelectorAll('button, input, [tabindex]:not([tabindex="-1"])');
                return {
                    totalElements: focusableElements.length,
                    canFocus: Array.from(focusableElements).every(el => typeof el.focus === 'function')
                };
            }

            testAriaLabels() {
                const buttons = document.querySelectorAll('button');
                const withAriaLabel = Array.from(buttons).filter(btn => 
                    btn.getAttribute('aria-label') || btn.textContent.trim()
                );
                
                return {
                    totalButtons: buttons.length,
                    withLabels: withAriaLabel.length,
                    coverage: (withAriaLabel.length / buttons.length * 100).toFixed(1)
                };
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        const mockDialog = new MockUserChoiceDialog();
        const mockAccessibility = new MockAccessibilityHelper();

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            container.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            container.scrollTop = container.scrollHeight;
        }

        function clearResults(containerId) {
            document.getElementById(containerId).textContent = 'ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...\n';
        }

        function updateMetric(metricId, value, unit = '') {
            document.getElementById(metricId).textContent = value + unit;
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ç¶šè¡Œæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        async function testPreviewFailure() {
            logResult('preview-results', 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆå¤±æ•—ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            try {
                const mockAds = [
                    { type: 'banner', width: 728, height: 90 },
                    { type: 'overlay', width: 300, height: 250 }
                ];

                const result = await mockDialog.showChoiceDialog(mockAds);
                logResult('preview-results', `ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä½œæˆæˆåŠŸ: ${result.dialogId}`, 'success');
                
                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¤±æ•—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                const continueEnabled = mockDialog.enableContinueWithoutPreview(result.dialogId);
                logResult('preview-results', `ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ç¶šè¡Œ: ${continueEnabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}`, continueEnabled ? 'success' : 'error');
                
            } catch (error) {
                logResult('preview-results', `ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        async function testPreviewTimeout() {
            logResult('preview-results', 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            const timeoutPromise = new Promise((resolve) => {
                setTimeout(() => {
                    resolve({ timeout: true, options: ['continue', 'wait'] });
                }, 100);
            });

            const result = await timeoutPromise;
            logResult('preview-results', `ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ¤œå‡º: ${result.timeout}`, 'success');
            logResult('preview-results', `åˆ©ç”¨å¯èƒ½ã‚ªãƒ—ã‚·ãƒ§ãƒ³: ${result.options.join(', ')}`, 'info');
        }

        async function testContinueWithoutPreview() {
            logResult('preview-results', 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ç¶šè¡Œãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const mockAds = [
                { type: 'popup', width: 400, height: 300 },
                { type: 'banner', width: 728, height: 90 },
                { type: 'overlay', width: 300, height: 250 }
            ];

            const result = await mockDialog.showChoiceDialog(mockAds);
            const continueEnabled = mockDialog.enableContinueWithoutPreview(result.dialogId);
            
            logResult('preview-results', `${mockAds.length}å€‹ã®åºƒå‘Šã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ãƒ¢ãƒ¼ãƒ‰: ${continueEnabled ? 'æˆåŠŸ' : 'å¤±æ•—'}`, continueEnabled ? 'success' : 'error');
            
            // å€‹åˆ¥é¸æŠã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            for (let i = 0; i < mockAds.length; i++) {
                const action = i % 2 === 0 ? 'allow' : 'block';
                logResult('preview-results', `åºƒå‘Š${i + 1} (${mockAds[i].type}): ${action}`, 'info');
            }
        }

        // ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        function testKeyboardNavigation() {
            logResult('accessibility-results', 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const result = mockAccessibility.testKeyboardNavigation();
            logResult('accessibility-results', `ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯èƒ½è¦ç´ : ${result.totalElements}å€‹`, 'info');
            logResult('accessibility-results', `ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ©Ÿèƒ½: ${result.canFocus ? 'æ­£å¸¸' : 'ç•°å¸¸'}`, result.canFocus ? 'success' : 'error');
            
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
            document.addEventListener('keydown', function testKeyHandler(e) {
                if (e.key === 'Tab' || e.key === 'Enter' || e.key === 'Escape') {
                    logResult('accessibility-results', `ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡º: ${e.key}`, 'success');
                }
            }, { once: true });
            
            logResult('accessibility-results', 'Tab, Enter, Escapeã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„', 'info');
        }

        function testScreenReader() {
            logResult('accessibility-results', 'ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const testMessages = [
                'åºƒå‘Šæ¤œå‡ºãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‹ãã¾ã—ãŸ',
                'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ',
                'å€‹åˆ¥é¸æŠãŒå®Œäº†ã—ã¾ã—ãŸ'
            ];

            testMessages.forEach((message, index) => {
                setTimeout(() => {
                    mockAccessibility.announceToScreenReader(message);
                    logResult('accessibility-results', `ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼é€šçŸ¥: ${message}`, 'success');
                }, index * 1000);
            });
        }

        function testFocusTrap() {
            logResult('accessibility-results', 'ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            const modal = document.createElement('div');
            modal.setAttribute('role', 'dialog');
            modal.setAttribute('aria-modal', 'true');
            modal.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ccc; z-index: 1000;';
            
            const button1 = document.createElement('button');
            button1.textContent = 'ãƒœã‚¿ãƒ³1';
            const button2 = document.createElement('button');
            button2.textContent = 'ãƒœã‚¿ãƒ³2';
            const closeButton = document.createElement('button');
            closeButton.textContent = 'é–‰ã˜ã‚‹';
            closeButton.onclick = () => {
                document.body.removeChild(modal);
                logResult('accessibility-results', 'ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
            };
            
            modal.appendChild(button1);
            modal.appendChild(button2);
            modal.appendChild(closeButton);
            document.body.appendChild(modal);
            
            button1.focus();
            logResult('accessibility-results', 'ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä½œæˆå®Œäº†ã€‚Tabã‚­ãƒ¼ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„', 'info');
        }

        function testAriaLabels() {
            logResult('accessibility-results', 'ARIAãƒ©ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const result = mockAccessibility.testAriaLabels();
            logResult('accessibility-results', `ç·ãƒœã‚¿ãƒ³æ•°: ${result.totalButtons}`, 'info');
            logResult('accessibility-results', `ãƒ©ãƒ™ãƒ«ä»˜ããƒœã‚¿ãƒ³: ${result.withLabels}`, 'info');
            logResult('accessibility-results', `ã‚«ãƒãƒ¬ãƒƒã‚¸: ${result.coverage}%`, result.coverage > 80 ? 'success' : 'error');
        }

        function testHighContrast() {
            logResult('accessibility-results', 'é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const supportsHighContrast = window.matchMedia && window.matchMedia('(prefers-contrast: high)').matches;
            logResult('accessibility-results', `é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰: ${supportsHighContrast ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}`, 'info');
            
            // é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¸€æ™‚çš„ã«é©ç”¨
            const style = document.createElement('style');
            style.textContent = `
                .test-button { border: 2px solid !important; }
                .mock-ad { border-width: 3px !important; }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => {
                document.head.removeChild(style);
                logResult('accessibility-results', 'é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
            }, 2000);
        }

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        async function testDialogCreationPerformance() {
            logResult('performance-results', 'ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä½œæˆæ€§èƒ½ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const iterations = 10;
            const times = [];
            
            for (let i = 0; i < iterations; i++) {
                const mockAds = Array.from({ length: 5 }, (_, j) => ({
                    type: `ad-${j}`,
                    width: 300,
                    height: 250
                }));
                
                const result = await mockDialog.showChoiceDialog(mockAds);
                times.push(result.creationTime);
            }
            
            const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
            const maxTime = Math.max(...times);
            const minTime = Math.min(...times);
            
            updateMetric('dialog-creation-time', avgTime.toFixed(1));
            logResult('performance-results', `å¹³å‡ä½œæˆæ™‚é–“: ${avgTime.toFixed(1)}ms`, avgTime < 100 ? 'success' : 'error');
            logResult('performance-results', `æœ€å¤§æ™‚é–“: ${maxTime.toFixed(1)}ms, æœ€å°æ™‚é–“: ${minTime.toFixed(1)}ms`, 'info');
        }

        async function testVisualFeedbackPerformance() {
            logResult('performance-results', 'è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ€§èƒ½ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const result = await mockDialog.showChoiceDialog([{ type: 'test' }]);
            const times = [];
            
            for (let i = 0; i < 20; i++) {
                const updateTime = mockDialog.updateVisualFeedback(result.dialogId);
                times.push(updateTime);
            }
            
            const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
            updateMetric('visual-feedback-time', avgTime.toFixed(1));
            logResult('performance-results', `å¹³å‡ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ™‚é–“: ${avgTime.toFixed(1)}ms`, avgTime < 50 ? 'success' : 'error');
        }

        async function testKeyboardPerformance() {
            logResult('performance-results', 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¿œç­”æ€§èƒ½ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const result = await mockDialog.showChoiceDialog([{ type: 'test' }]);
            const keys = ['1', '2', '3', 'a', 'b'];
            const times = [];
            
            keys.forEach(key => {
                const responseTime = mockDialog.handleKeyboardShortcut(result.dialogId, key);
                times.push(responseTime);
            });
            
            const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
            updateMetric('keyboard-response-time', avgTime.toFixed(1));
            logResult('performance-results', `å¹³å‡å¿œç­”æ™‚é–“: ${avgTime.toFixed(1)}ms`, avgTime < 16 ? 'success' : 'error');
        }

        function testMemoryUsage() {
            logResult('performance-results', 'ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            if (performance.memory) {
                const memoryInfo = performance.memory;
                const usedMB = (memoryInfo.usedJSHeapSize / 1024 / 1024).toFixed(1);
                const totalMB = (memoryInfo.totalJSHeapSize / 1024 / 1024).toFixed(1);
                
                updateMetric('memory-usage', usedMB);
                logResult('performance-results', `ä½¿ç”¨ãƒ¡ãƒ¢ãƒª: ${usedMB}MB / ${totalMB}MB`, 'info');
            } else {
                logResult('performance-results', 'ãƒ¡ãƒ¢ãƒªæƒ…å ±ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
            }
        }

        async function testBulkOperations() {
            logResult('performance-results', 'ä¸€æ‹¬æ“ä½œæ€§èƒ½ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const startTime = performance.now();
            
            // å¤§é‡ã®åºƒå‘Šã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            const manyAds = Array.from({ length: 50 }, (_, i) => ({
                type: `ad-${i}`,
                width: 300,
                height: 250
            }));
            
            const result = await mockDialog.showChoiceDialog(manyAds);
            
            // ä¸€æ‹¬æ“ä½œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            for (let i = 0; i < manyAds.length; i++) {
                mockDialog.updateVisualFeedback(result.dialogId);
            }
            
            const endTime = performance.now();
            const totalTime = endTime - startTime;
            
            logResult('performance-results', `50å€‹åºƒå‘Šã®ä¸€æ‹¬å‡¦ç†: ${totalTime.toFixed(1)}ms`, totalTime < 500 ? 'success' : 'error');
        }

        // ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒ†ã‚¹ãƒˆ
        function testBrowserFeatures() {
            logResult('compatibility-results', 'ãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½æ¤œå‡ºãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const features = mockAccessibility.getBrowserFeatures();
            
            Object.entries(features).forEach(([feature, supported]) => {
                logResult('compatibility-results', `${feature}: ${supported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, supported ? 'success' : 'error');
            });
            
            // ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±ã‚’æ›´æ–°
            const userAgent = navigator.userAgent;
            if (userAgent.includes('Chrome')) {
                document.getElementById('chrome-version').textContent = 'Chromeæ¤œå‡º';
            } else if (userAgent.includes('Firefox')) {
                document.getElementById('firefox-version').textContent = 'Firefoxæ¤œå‡º';
            } else if (userAgent.includes('Safari')) {
                document.getElementById('safari-version').textContent = 'Safariæ¤œå‡º';
            } else if (userAgent.includes('Edge')) {
                document.getElementById('edge-version').textContent = 'Edgeæ¤œå‡º';
            }
        }

        function testCSSSupport() {
            logResult('compatibility-results', 'CSSæ©Ÿèƒ½ã‚µãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const testElement = document.createElement('div');
            
            // CSS Grid
            testElement.style.display = 'grid';
            const gridSupported = testElement.style.display === 'grid';
            logResult('compatibility-results', `CSS Grid: ${gridSupported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, gridSupported ? 'success' : 'error');
            
            // Flexbox
            testElement.style.display = 'flex';
            const flexSupported = testElement.style.display === 'flex';
            logResult('compatibility-results', `Flexbox: ${flexSupported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, flexSupported ? 'success' : 'error');
            
            // CSS Variables
            const variablesSupported = CSS && CSS.supports && CSS.supports('--test', 'value');
            logResult('compatibility-results', `CSS Variables: ${variablesSupported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, variablesSupported ? 'success' : 'error');
        }

        function testEventHandling() {
            logResult('compatibility-results', 'ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†äº’æ›æ€§ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const testElement = document.createElement('button');
            
            // addEventListener
            const addEventSupported = typeof testElement.addEventListener === 'function';
            logResult('compatibility-results', `addEventListener: ${addEventSupported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, addEventSupported ? 'success' : 'error');
            
            // removeEventListener
            const removeEventSupported = typeof testElement.removeEventListener === 'function';
            logResult('compatibility-results', `removeEventListener: ${removeEventSupported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, removeEventSupported ? 'success' : 'error');
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
            let eventFired = false;
            const testHandler = () => { eventFired = true; };
            
            if (addEventSupported) {
                testElement.addEventListener('click', testHandler);
                testElement.click();
                logResult('compatibility-results', `ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«: ${eventFired ? 'æˆåŠŸ' : 'å¤±æ•—'}`, eventFired ? 'success' : 'error');
            }
        }

        function testDOMManipulation() {
            logResult('compatibility-results', 'DOMæ“ä½œäº’æ›æ€§ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            // querySelector
            const querySelectorSupported = typeof document.querySelector === 'function';
            logResult('compatibility-results', `querySelector: ${querySelectorSupported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, querySelectorSupported ? 'success' : 'error');
            
            // querySelectorAll
            const querySelectorAllSupported = typeof document.querySelectorAll === 'function';
            logResult('compatibility-results', `querySelectorAll: ${querySelectorAllSupported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, querySelectorAllSupported ? 'success' : 'error');
            
            // classList
            const testElement = document.createElement('div');
            const classListSupported = 'classList' in testElement;
            logResult('compatibility-results', `classList: ${classListSupported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, classListSupported ? 'success' : 'error');
            
            // setAttribute
            const setAttributeSupported = typeof testElement.setAttribute === 'function';
            logResult('compatibility-results', `setAttribute: ${setAttributeSupported ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`, setAttributeSupported ? 'success' : 'error');
        }

        // çµ±åˆãƒ†ã‚¹ãƒˆ
        async function runFullIntegrationTest() {
            logResult('integration-results', 'å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            try {
                // 1. è¤‡æ•°åºƒå‘Šæ¤œå‡º
                const mockAds = [
                    { type: 'banner', width: 728, height: 90 },
                    { type: 'overlay', width: 300, height: 250 },
                    { type: 'popup', width: 400, height: 300 }
                ];
                
                logResult('integration-results', `ã‚¹ãƒ†ãƒƒãƒ—1: ${mockAds.length}å€‹ã®åºƒå‘Šã‚’æ¤œå‡º`, 'info');
                
                // 2. ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
                const result = await mockDialog.showChoiceDialog(mockAds);
                logResult('integration-results', `ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä½œæˆå®Œäº† (${result.creationTime.toFixed(1)}ms)`, 'success');
                
                // 3. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¤±æ•—ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                const continueEnabled = mockDialog.enableContinueWithoutPreview(result.dialogId);
                logResult('integration-results', `ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ãƒ¢ãƒ¼ãƒ‰ ${continueEnabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}`, continueEnabled ? 'success' : 'error');
                
                // 4. å€‹åˆ¥é¸æŠ
                for (let i = 0; i < mockAds.length; i++) {
                    const action = i % 2 === 0 ? 'allow' : 'block';
                    const responseTime = mockDialog.handleKeyboardShortcut(result.dialogId, (i + 1).toString());
                    logResult('integration-results', `ã‚¹ãƒ†ãƒƒãƒ—4.${i + 1}: åºƒå‘Š${i + 1}ã‚’${action} (${responseTime.toFixed(1)}ms)`, 'success');
                }
                
                // 5. è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                const feedbackTime = mockDialog.updateVisualFeedback(result.dialogId);
                logResult('integration-results', `ã‚¹ãƒ†ãƒƒãƒ—5: è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ›´æ–° (${feedbackTime.toFixed(1)}ms)`, 'success');
                
                // 6. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                mockDialog.cleanup();
                logResult('integration-results', 'ã‚¹ãƒ†ãƒƒãƒ—6: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†', 'success');
                
                logResult('integration-results', 'å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆæˆåŠŸï¼', 'success');
                
            } catch (error) {
                logResult('integration-results', `çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        async function runAccessibilityIntegrationTest() {
            logResult('integration-results', 'ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£çµ±åˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
            const navResult = mockAccessibility.testKeyboardNavigation();
            logResult('integration-results', `ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³: ${navResult.canFocus ? 'æˆåŠŸ' : 'å¤±æ•—'}`, navResult.canFocus ? 'success' : 'error');
            
            // ARIAãƒ©ãƒ™ãƒ«
            const ariaResult = mockAccessibility.testAriaLabels();
            logResult('integration-results', `ARIAãƒ©ãƒ™ãƒ«ã‚«ãƒãƒ¬ãƒƒã‚¸: ${ariaResult.coverage}%`, ariaResult.coverage > 80 ? 'success' : 'error');
            
            // ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼é€šçŸ¥
            mockAccessibility.announceToScreenReader('ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†');
            logResult('integration-results', 'ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼é€šçŸ¥: é€ä¿¡å®Œäº†', 'success');
            
            logResult('integration-results', 'ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
        }

        async function runPerformanceIntegrationTest() {
            logResult('integration-results', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const startTime = performance.now();
            
            // è¤‡æ•°ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚’ä¸¦è¡Œå®Ÿè¡Œ
            const tests = [
                testDialogCreationPerformance(),
                testVisualFeedbackPerformance(),
                testKeyboardPerformance()
            ];
            
            await Promise.all(tests);
            
            const endTime = performance.now();
            const totalTime = endTime - startTime;
            
            logResult('integration-results', `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº† (${totalTime.toFixed(1)}ms)`, totalTime < 1000 ? 'success' : 'error');
        }

        async function runStressTest() {
            logResult('integration-results', 'ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            const iterations = 100;
            const errors = [];
            
            for (let i = 0; i < iterations; i++) {
                try {
                    const mockAds = Array.from({ length: Math.floor(Math.random() * 10) + 1 }, (_, j) => ({
                        type: `stress-ad-${j}`,
                        width: Math.floor(Math.random() * 500) + 100,
                        height: Math.floor(Math.random() * 300) + 50
                    }));
                    
                    const result = await mockDialog.showChoiceDialog(mockAds);
                    mockDialog.enableContinueWithoutPreview(result.dialogId);
                    mockDialog.updateVisualFeedback(result.dialogId);
                    
                    if (i % 10 === 0) {
                        logResult('integration-results', `ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆé€²è¡Œ: ${i}/${iterations}`, 'info');
                    }
                    
                } catch (error) {
                    errors.push({ iteration: i, error: error.message });
                }
            }
            
            mockDialog.cleanup();
            
            logResult('integration-results', `ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†: ${iterations - errors.length}/${iterations} æˆåŠŸ`, errors.length === 0 ? 'success' : 'error');
            
            if (errors.length > 0) {
                logResult('integration-results', `ã‚¨ãƒ©ãƒ¼æ•°: ${errors.length}`, 'error');
                errors.slice(0, 5).forEach(err => {
                    logResult('integration-results', `ã‚¨ãƒ©ãƒ¼ä¾‹: ${err.error}`, 'error');
                });
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logResult('preview-results', 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã—ç¶šè¡Œæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
            logResult('accessibility-results', 'ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
            logResult('performance-results', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
            logResult('compatibility-results', 'ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
            logResult('integration-results', 'çµ±åˆãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
            
            // ãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½ã‚’è‡ªå‹•æ¤œå‡º
            testBrowserFeatures();
        });
    </script>
</body>
</html>